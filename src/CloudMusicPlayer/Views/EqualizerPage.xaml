<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:CloudMusicPlayer.ViewModels"
             xmlns:models="clr-namespace:CloudMusicPlayer.Models"
             x:Class="CloudMusicPlayer.Views.EqualizerPage"
             x:DataType="vm:EqualizerViewModel"
             Title="{Binding Title}">

    <Grid RowDefinitions="Auto,Auto,*,Auto" Padding="20">
        <!-- Enable/Disable Toggle -->
        <Grid Grid.Row="0" ColumnDefinitions="*,Auto" Padding="0,10">
            <Label Grid.Column="0" Text="Equalizer" FontSize="18" FontAttributes="Bold" VerticalOptions="Center" />
            <Switch Grid.Column="1"
                    IsToggled="{Binding IsEnabled}"
                    OnColor="{StaticResource Primary}"
                    IsVisible="{Binding IsSupported}" />
        </Grid>

        <!-- Not Supported Message -->
        <Frame Grid.Row="1"
               IsVisible="{Binding IsSupported, Converter={StaticResource InverseBoolConverter}}"
               BackgroundColor="{AppThemeBinding Light=#FFF3E0, Dark=#3E2723}"
               CornerRadius="10"
               Padding="15"
               Margin="0,10">
            <Label Text="{Binding NotSupportedMessage}"
                   FontSize="14"
                   TextColor="{AppThemeBinding Light=#E65100, Dark=#FFB74D}" />
        </Frame>

        <!-- EQ Bands -->
        <Grid Grid.Row="2"
              ColumnDefinitions="*,*,*,*,*"
              RowDefinitions="*,Auto"
              IsVisible="{Binding IsSupported}"
              Margin="0,20,0,10">
            <!-- Band Sliders (vertical) -->
            <VerticalStackLayout Grid.Column="0" Grid.Row="0" HorizontalOptions="Center" Spacing="5">
                <Label Text="60Hz" FontSize="10" TextColor="Gray" HorizontalTextAlignment="Center" />
                <Slider Minimum="{Binding MinLevel}"
                        Maximum="{Binding MaxLevel}"
                        Value="{Binding Band1}"
                        Rotation="270"
                        WidthRequest="150"
                        MinimumTrackColor="{StaticResource Primary}"
                        ThumbColor="{StaticResource Primary}" />
                <Label Text="{Binding Band1, StringFormat='{0} dB'}" FontSize="10" TextColor="Gray" HorizontalTextAlignment="Center" />
            </VerticalStackLayout>

            <VerticalStackLayout Grid.Column="1" Grid.Row="0" HorizontalOptions="Center" Spacing="5">
                <Label Text="230Hz" FontSize="10" TextColor="Gray" HorizontalTextAlignment="Center" />
                <Slider Minimum="{Binding MinLevel}"
                        Maximum="{Binding MaxLevel}"
                        Value="{Binding Band2}"
                        Rotation="270"
                        WidthRequest="150"
                        MinimumTrackColor="{StaticResource Primary}"
                        ThumbColor="{StaticResource Primary}" />
                <Label Text="{Binding Band2, StringFormat='{0} dB'}" FontSize="10" TextColor="Gray" HorizontalTextAlignment="Center" />
            </VerticalStackLayout>

            <VerticalStackLayout Grid.Column="2" Grid.Row="0" HorizontalOptions="Center" Spacing="5">
                <Label Text="910Hz" FontSize="10" TextColor="Gray" HorizontalTextAlignment="Center" />
                <Slider Minimum="{Binding MinLevel}"
                        Maximum="{Binding MaxLevel}"
                        Value="{Binding Band3}"
                        Rotation="270"
                        WidthRequest="150"
                        MinimumTrackColor="{StaticResource Primary}"
                        ThumbColor="{StaticResource Primary}" />
                <Label Text="{Binding Band3, StringFormat='{0} dB'}" FontSize="10" TextColor="Gray" HorizontalTextAlignment="Center" />
            </VerticalStackLayout>

            <VerticalStackLayout Grid.Column="3" Grid.Row="0" HorizontalOptions="Center" Spacing="5">
                <Label Text="4kHz" FontSize="10" TextColor="Gray" HorizontalTextAlignment="Center" />
                <Slider Minimum="{Binding MinLevel}"
                        Maximum="{Binding MaxLevel}"
                        Value="{Binding Band4}"
                        Rotation="270"
                        WidthRequest="150"
                        MinimumTrackColor="{StaticResource Primary}"
                        ThumbColor="{StaticResource Primary}" />
                <Label Text="{Binding Band4, StringFormat='{0} dB'}" FontSize="10" TextColor="Gray" HorizontalTextAlignment="Center" />
            </VerticalStackLayout>

            <VerticalStackLayout Grid.Column="4" Grid.Row="0" HorizontalOptions="Center" Spacing="5">
                <Label Text="14kHz" FontSize="10" TextColor="Gray" HorizontalTextAlignment="Center" />
                <Slider Minimum="{Binding MinLevel}"
                        Maximum="{Binding MaxLevel}"
                        Value="{Binding Band5}"
                        Rotation="270"
                        WidthRequest="150"
                        MinimumTrackColor="{StaticResource Primary}"
                        ThumbColor="{StaticResource Primary}" />
                <Label Text="{Binding Band5, StringFormat='{0} dB'}" FontSize="10" TextColor="Gray" HorizontalTextAlignment="Center" />
            </VerticalStackLayout>
        </Grid>

        <!-- Presets -->
        <VerticalStackLayout Grid.Row="3" Spacing="10" IsVisible="{Binding IsSupported}">
            <Label Text="Presets" FontSize="16" FontAttributes="Bold" />
            <FlexLayout BindableLayout.ItemsSource="{Binding Presets}"
                        Wrap="Wrap"
                        JustifyContent="Start"
                        AlignItems="Start">
                <BindableLayout.ItemTemplate>
                    <DataTemplate x:DataType="models:EqualizerPreset">
                        <Button Text="{Binding Name}"
                                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:EqualizerViewModel}}, Path=ApplyPresetCommand}"
                                CommandParameter="{Binding .}"
                                FontSize="13"
                                HeightRequest="36"
                                CornerRadius="18"
                                Padding="15,0"
                                Margin="4"
                                BackgroundColor="{AppThemeBinding Light=#F0F0F0, Dark=#333}"
                                TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                    </DataTemplate>
                </BindableLayout.ItemTemplate>
            </FlexLayout>
        </VerticalStackLayout>
    </Grid>
</ContentPage>
